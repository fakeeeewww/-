#NAT

网络地址转换（英语：Network Address Translation，缩写：NAT；又称网络掩蔽、IP掩蔽）在计算机网络中是一种在IP数据包通过路由器或防火墙时重写**来源IP地址(SNAT)**或**目的IP地址(DNAT)**的技术。这种技术被普遍使用在有多台主机但只通过一个公有IP地址访问互联网的私有网络中。它是一个方便且得到了广泛应用的技术。当然，NAT也让主机之间的通信变得复杂，导致了通信效率的降低。

#NAT的分为SNAT和DNAT
1.    SNAT是source networkaddress translation的缩写，即源地址目标转换。比如，多个PC机使用ADSL路由器共享上网，每个PC机都配置了内网IP，PC机访问外部网络的时候，路由器将数据包的报头中的源地址替换成路由器的ip，当外部网络的服务器比如网站web服务器接到访问请求的时候，他的日志记录下来的是路由器的ip地址，而不是pc机的内网ip，这是因为，这个服务器收到的数据包的报头里边的“源地址”，已经被替换了，所以叫做SNAT，基于源地址的地址转换。
2.    DNAT是destination networkaddress translation的缩写，即目标网络地址转换，典型的应用是，有个web服务器放在内网配置内网ip，前端有个防火墙配置公网ip，互联网上的访问者使用公网ip来访问这个网站，当访问的时候，客户端发出一个数据包，这个数据包的报头里边，目标地址写的是防火墙的公网ip，防火墙会把这个数据包的报头改写一次，将目标地址改写成web服务器的内网ip，然后再把这个数据包发送到内网的web服务器上，这样，数据包就穿透了防火墙，并从公网ip变成了一个对内网地址的访问了，即DNAT，基于目标的网络地址转换。


#端口映射
端口映射是 NAT 的一种，它将外网主机的 IP 地址的一个端口映射到内网中一台机器，提供相应的服务。当用户访问该 IP 的这个端口时，服务器自动将请求映射到对应局域网内部的机器上。
现在市场上的家庭路由器都具备 NAT 功能，也可以实现端口映射。下图为小米路由器的端口映射设置图：
![](https://img-blog.csdn.net/20150424173603893)
    我们平时经过路由器，通过宽带，最终去到运营商那边，数据是从运营商出去，最终数据是回到运营商那边，运营商再把数据发送到用户的电脑。
路由器，至少有两个端口：WAN 口和 LAN 口。
WAN：接外部 IP 地址用，通常指的是出口，转发来自内部 LAN 接口的 IP 数据包，这个口的 IP 是唯一的。

LAN：接内部 IP 地址用，LAN 内部是交换机。

这里，我们简化这个过程，我们把运营商当做一个 NAT 设备。
![](https://img-blog.csdn.net/20150603162431053)


#参考文章
1.    [内网和外网之间的通信（端口映射原理） - ranyonsue - 博客园 (cnblogs.com)](https://www.cnblogs.com/ranyonsue/p/9713992.html)
2.    NAT的简单流程【图文】_susansan_51CTO博客
3.    (19条消息) IPtables中SNAT、DNAT和MASQUERADE的含义_jk110333的专栏-CSDN博客_masquerade
